<div class="dashboard">
  <main class="main-content">
    <!-- Page header -->
    <div class="header">
      <h1 class="page-title">Admin Panel</h1>
    </div>

    <section class="admin-card">
      <h2 class="card-title">{{ editing ? "Edit User" : "Create User" }}</h2>

      <form [formGroup]="form" (ngSubmit)="save()" novalidate>
        <!-- Bootstrap row for 3 columns -->
        <div class="row g-3 mb-3">
          <!-- Username -->
          <div class="col-12 col-md-4">
            <label for="username" class="form-label">Username</label>
            <div class="input-group">
              <span class="input-group-text">
                <svg
                  class="stat-icon user"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <circle cx="12" cy="7" r="4"></circle>
                  <path d="M5.5 21a8.38 8.38 0 0113 0"></path>
                </svg>
              </span>

              <input
                type="text"
                id="username"
                class="form-control rounded-pill"
                formControlName="username"
                placeholder="Username"
              />
            </div>
          </div>

          <!-- Email -->
          <div class="col-12 col-md-4">
            <label for="email" class="form-label">Email</label>
            <div class="input-group">
              <span class="input-group-text">
                <svg
                  class="stat-icon email"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <rect x="3" y="5" width="18" height="14" rx="2" ry="2"></rect>
                  <polyline points="22,7 12,13 2,7"></polyline>
                </svg>
              </span>
              <input
                type="email"
                id="email"
                class="form-control rounded-pill"
                formControlName="email"
                placeholder="Email"
              />
            </div>
          </div>

          <!-- Password -->
          <div class="col-12 col-md-4">
            <label for="password" class="form-label">Password</label>
            <div class="input-group">
              <span class="input-group-text">
                <svg
                  class="stat-icon password"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <rect
                    x="3"
                    y="11"
                    width="18"
                    height="11"
                    rx="2"
                    ry="2"
                  ></rect>
                  <path d="M7 11V7a5 5 0 0110 0v4"></path>
                </svg>
              </span>
              <input
                [type]="showPassword ? 'text' : 'password'"
                id="password"
                class="form-control rounded-pill"
                formControlName="password"
                placeholder="Password"
              />
              <button
                type="button"
                class="input-group-text password-toggle clickable"
                (click)="toggleShowPassword()"
                title="Toggle password visibility"
              >
                <i
                  class="bi"
                  [ngClass]="showPassword ? 'bi-eye-slash' : 'bi-eye'"
                ></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Superuser checkbox -->
        <div class="form-check mb-3">
          <input
            class="form-check-input"
            type="checkbox"
            id="is_superuser"
            formControlName="is_superuser"
          />
          <label class="form-check-label" for="is_superuser"> Superuser </label>
        </div>

        <div class="form-check mb-3">
          <input
            class="form-check-input"
            type="checkbox"
            id="is_active"
            formControlName="is_active"
          />
          <label class="form-check-label" for="is_active"> Active </label>
        </div>

        <!-- Action buttons -->
        <div class="d-flex gap-2">
          <button
            type="submit"
            class="btn btn-primary rounded-pill px-4"
            [disabled]="form.invalid"
          >
            {{ editing ? "Update" : "Create" }}
          </button>
          <button
            *ngIf="editing"
            type="button"
            class="btn btn-secondary rounded-pill px-4"
            (click)="startCreate()"
          >
            Cancel
          </button>
        </div>
      </form>
    </section>

    <section class="admin-card">
      <h2 class="card-title">Existing Users</h2>
      <table
        mat-table
        [dataSource]="users"
        class="mat-elevation-z2 full-width-table"
      >
        <!-- USER COLUMN -->
        <ng-container matColumnDef="user">
          <th mat-header-cell *matHeaderCellDef>User</th>
          <td mat-cell *matCellDef="let u">
            <div class="user-cell">
              <div class="user-id">{{ u.id }}</div>
              <div class="user-info">
                <div class="username">{{ u.username }}</div>
                <div class="email">{{ u.email }}</div>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- ROLE COLUMN -->
        <ng-container matColumnDef="role">
          <th mat-header-cell *matHeaderCellDef>Role</th>
          <td mat-cell *matCellDef="let u">
            <span
              class="role-badge"
              [ngClass]="u.is_superuser ? 'superuser' : 'user'"
            >
              {{ u.is_superuser ? "Superuser" : "User" }}
            </span>
          </td>
        </ng-container>

        <!-- ACTIONS COLUMN -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let u">
            <button
              class="action-icon edit"
              (click)="openEditDialog(u)"
              matTooltip="Edit user"
            >
              <!-- pencil SVG -->
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M12 20h9"></path>
                <path
                  d="M16.5 3.5a2.121 2.121 0 113 3L7 19l-4 1 1-4L16.5 3.5z"
                ></path>
              </svg>
            </button>
            <button
              class="action-icon delete"
              (click)="remove(u)"
              matTooltip="Delete user"
            >
              <!-- trash SVG -->
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                xmlns="http://www.w3.org/2000/svg"
              >
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"></path>
                <path d="M10 11v6"></path>
                <path d="M14 11v6"></path>
                <path d="M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2"></path>
              </svg>
            </button>
          </td>
        </ng-container>

        <!-- ROW DEFINITIONS (no wrappers) -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        <tr class="empty-row" *ngIf="!users?.length">
          <td [attr.colspan]="displayedColumns.length">
            Aucun utilisateur ne correspond aux crit√®res de recherche
          </td>
        </tr>
      </table>
    </section>
  </main>
</div>
